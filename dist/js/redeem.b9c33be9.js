(function(e){function t(t){for(var r,a,i=t[0],u=t[1],l=t[2],d=0,m=[];d<i.length;d++)a=i[d],Object.prototype.hasOwnProperty.call(o,a)&&o[a]&&m.push(o[a][0]),o[a]=0;for(r in u)Object.prototype.hasOwnProperty.call(u,r)&&(e[r]=u[r]);c&&c(t);while(m.length)m.shift()();return n.push.apply(n,l||[]),s()}function s(){for(var e,t=0;t<n.length;t++){for(var s=n[t],r=!0,i=1;i<s.length;i++){var u=s[i];0!==o[u]&&(r=!1)}r&&(n.splice(t--,1),e=a(a.s=s[0]))}return e}var r={},o={redeem:0},n=[];function a(t){if(r[t])return r[t].exports;var s=r[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,a),s.l=!0,s.exports}a.m=e,a.c=r,a.d=function(e,t,s){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(a.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(s,r,function(t){return e[t]}.bind(null,r));return s},a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],u=i.push.bind(i);i.push=t,i=i.slice();for(var l=0;l<i.length;l++)t(i[l]);var c=u;n.push([2,"chunk-vendors"]),s()})({0:function(e,t){},2:function(e,t,s){e.exports=s("fe58")},"70c8":function(e,t,s){"use strict";s("f559");var r=s("2b0e");t["a"]={beforeCreate:function(){r["default"].http.options.root=window.m.urlRoot,r["default"].http.interceptors.push((function(e,t){e.url.startsWith("user/authenticate")||(e.xhr=e.xhr||{},e.xhr.withCredentials=!0,localStorage.token&&e.headers.set("Authorization","Bearer "+localStorage.getItem("token"))),t()}))}}},fe58:function(e,t,s){"use strict";s.r(t);s("cadf"),s("551c"),s("f751"),s("097d");var r=s("2b0e"),o=s("28dd"),n=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("redeem-hero",{attrs:{user:e.user,redeemInfo:e.redeemInfo}})},a=[],i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("section",{staticClass:"hero gift-hero redeem-hero"},[s("div",{staticClass:"hero-bg",staticStyle:{"background-image":"url('/img/gift/hero.jpg')"}}),s("div",{staticClass:"hero-wrapper"},[e._m(0),s("div",{staticClass:"gift-form redeem-stage"},[s("transition",{attrs:{name:"gift-form",method:"out-in"}},[e.redeemInfo.redeemSuccess||1!=e.redeemInfo.step?e._e():s("redeem-form-1",{attrs:{user:e.user,redeemInfo:e.redeemInfo},on:{newHeight:e.setNewHeight}}),e.redeemInfo.redeemSuccess||2!=e.redeemInfo.step?e._e():s("redeem-form-2",{attrs:{user:e.user,redeemInfo:e.redeemInfo},on:{newHeight:e.setNewHeight}}),1==e.redeemInfo.redeemSuccess?s("redeem-success",{attrs:{user:e.user,redeemInfo:e.redeemInfo},on:{newHeight:e.setNewHeight}}):e._e()],1)],1)])])},u=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"gift-hero-headline"},[s("h2",[e._v("Redeem your code")]),s("p",{staticClass:"subheading hero-subheading"},[e._v("Activate your new Momentum Plus benefits")])])}],l=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("form",[e._m(0),s("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.redeemInfo.coupon_code,expression:"redeemInfo.coupon_code",modifiers:{trim:!0}},{name:"focus",rawName:"v-focus",value:e.codeFocused,expression:"codeFocused"}],staticClass:"gift-form-coupon-code",attrs:{id:"coupon-code",type:"text"},domProps:{value:e.redeemInfo.coupon_code},on:{blur:[function(t){e.codeFocused=!1},function(t){return e.$forceUpdate()}],focus:function(t){e.codeFocused=!0},input:function(t){t.target.composing||e.$set(e.redeemInfo,"coupon_code",t.target.value.trim())}}}),s("label",{staticClass:"gift-form-label",attrs:{for:"email"}},[e._v("Email")]),s("input",{directives:[{name:"focus",rawName:"v-focus",value:e.emailFocused,expression:"emailFocused"},{name:"model",rawName:"v-model.trim",value:e.user.email,expression:"user.email",modifiers:{trim:!0}}],staticClass:"gift-form-email",attrs:{id:"email",type:"text"},domProps:{value:e.user.email},on:{blur:[function(t){e.emailFocused=!1},function(t){return e.$forceUpdate()}],focus:function(t){e.emailFocused=!0},input:function(t){t.target.composing||e.$set(e.user,"email",t.target.value.trim())}}}),s("div",{staticClass:"gift-form-footer"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.buttonLabel,expression:"buttonLabel"}],attrs:{type:"submit"},domProps:{value:e.buttonLabel},on:{click:function(t){return t.preventDefault(),e.redeemCoupon(t)},input:function(t){t.target.composing||(e.buttonLabel=t.target.value)}}}),s("transition",{attrs:{name:"gift-form-message",mode:"out-in"}},[s("p",{key:e.errorMessage,staticClass:"gift-form-message"},[e._v(e._s(e.errorMessage))])])],1)])},c=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("label",{staticClass:"gift-form-label",attrs:{for:"coupon-code"}},[e._v("Enter your code "),s("span",{staticClass:"gift-form-sublabel"},[e._v("or click the link in your email")])])}],d=(s("3b2b"),s("a481"),s("f837").mixin),m={data:function(){return{testMode:!1,emailExists:null,buttonLabel:"Next",errorMessage:null,processing:!1,codeFocused:!0,emailFocused:!1}},mixins:[d],props:["user","redeemInfo"],created:function(){var e=this.getParameterByName("code");e&&(this.redeemInfo.coupon_code=e,this.checkCoupon())},mounted:function(){this.$emit("newHeight",this.$el.offsetHeight)},methods:{redeemCoupon:function(){var e=this,t=this.redeemInfo,s=this.validate();this.displayError(s),s||(this.processing=!0,this.buttonLabel="Loading...",this.checkCouponStatus((function(){e.buttonLabel="Next",e.processing=!1;var s=null;t.redeemable?t.step=2:0==t.redeemable&&(s=t.error),e.displayError(s)})))},getParameterByName:function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var s=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)"),r=s.exec(t);return r?r[2]?decodeURIComponent(r[2].replace(/\+/g," ")):"":null},displayError:function(e){var t=this;this.errorMessage="",e&&this.$nextTick((function(){this.errorMessage=e,setTimeout((function(){t.$emit("newHeight",t.$el.offsetHeight)}),20)}))},setEmailFocused:function(){this.emailFocused=!0,this.codeFocused=!1},setCodeFocused:function(){this.emailFocused=!1,this.codeFocused=!0},checkCouponStatus:function(e){var t=this,s=t.user,o=t.redeemInfo;if(o.coupon_code&&o.coupon_code.length>=9){var n="account/redemptionstatus?coupon_code="+encodeURIComponent(o.coupon_code)+"&email="+encodeURIComponent(s.email);r["default"].http.get(n).then((function(r){if(r.ok){var n=r.body;o.redeemable=n.redeemable,o.error=o.redeemable?null:n.error_message,o.description=n.gift_type,s.exists=n.user_exists,t.setCodeFocused()}else o.redeemable=null,o.description=null,s.exists=null;e&&e()}),(function(r){404==r.status?(o.redeemable=!1,t.setCodeFocused(),o.error="We were unable to find that gift code.",s.exists=null):(o.redeemable=null,s.exists=null),o.description=null,e&&e()}))}},validate:function(){return!this.redeemInfo.coupon_code||this.redeemInfo.coupon_code.length<7?(this.setCodeFocused(),"Please enter your gift code."):!this.user.email||this.user.email.length<7?(this.setEmailFocused(),"Please enter your email address."):/^.+@.+$/.test(this.user.email)?null:(this.setEmailFocused(),"Please enter a valid email address.")}}},f=m,p=s("2877"),h=Object(p["a"])(f,l,c,!1,null,null,null),g=h.exports,v=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("form",[e.user.exists&&e.user.name?s("h2",[e._v("Hello, "+e._s(e.user.name)+"!")]):s("h2",[e._v("Hello!")]),s("p",{staticClass:"gift-redeem-confirm"},[e._v("Redeem "+e._s(e.redeemInfo.description)+"?")]),e.user.exists?e._e():s("label",{staticClass:"gift-form-label",attrs:{for:"username"}},[e._v("Name")]),e.user.exists?e._e():s("input",{directives:[{name:"model",rawName:"v-model",value:e.user.name,expression:"user.name"},{name:"focus",rawName:"v-focus",value:!e.passwordFocused,expression:"!passwordFocused"}],attrs:{id:"username",type:"text"},domProps:{value:e.user.name},on:{input:function(t){t.target.composing||e.$set(e.user,"name",t.target.value)}}}),0==e.user.exists?s("label",{staticClass:"gift-form-label",attrs:{for:"password"}},[e._v("Choose a password")]):e._e(),0==e.user.exists?s("input",{directives:[{name:"model",rawName:"v-model",value:e.user.password,expression:"user.password"},{name:"focus",rawName:"v-focus",value:e.passwordFocused,expression:"passwordFocused"}],staticClass:"gift-form-password",attrs:{id:"password",type:"password"},domProps:{value:e.user.password},on:{blur:function(t){e.passwordFocused=!1},focus:function(t){e.passwordFocused=!0},input:function(t){t.target.composing||e.$set(e.user,"password",t.target.value)}}}):e._e(),s("div",{staticClass:"gift-form-footer"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.buttonLabel,expression:"buttonLabel"}],attrs:{type:"submit"},domProps:{value:e.buttonLabel},on:{click:function(t){return t.preventDefault(),e.redeemCoupon(t)},input:function(t){t.target.composing||(e.buttonLabel=t.target.value)}}}),s("transition",{attrs:{name:"gift-form-message",mode:"out-in"}},[s("p",{key:e.errorMessage,staticClass:"gift-form-message"},[e._v(e._s(e.errorMessage))])])],1)])},b=[],_=(s("7f7f"),s("f837").mixin),w={data:function(){return{buttonLabelDefault:"Yes, Redeem",buttonLabel:"Yes, Redeem",errorMessage:null,processing:!1,passwordFocused:!1}},mixins:[_],props:["user","redeemInfo"],computed:{},mounted:function(){this.$emit("newHeight",this.$el.offsetHeight)},methods:{redeemCoupon:function(){var e=this,t=this.user,s=this.redeemInfo,o=this.validate();if(this.displayError(o),!o){this.buttonLabel="Redeeming...",this.inProgress=!0;var n={coupon_code:s.coupon_code,email:t.email,password:t.password,name:t.exists?null:t.name};r["default"].http.post("account/redeem",n).then((function(t){if(t.ok){var r=t.body;if(r.success)s.redeemSuccess=!0;else{s.redeemSuccess=!1;var o=r.error_message||"There was an error redeeming the code.";e.displayError(o)}}else{s.redeemSuccess=!1;o="There was an error redeeming the code.";e.displayError(o)}e.inProgress=!1,e.buttonLabel=e.buttonLabelDefault}),(function(t){e.displayError("There was an error redeeming the code."),s.redeemSuccess=null,e.inProgress=!1,e.buttonLabel=e.buttonLabelDefault}))}},displayError:function(e){var t=this;this.errorMessage="",e&&this.$nextTick((function(){this.errorMessage=e,setTimeout((function(){t.$emit("newHeight",t.$el.offsetHeight)}),20)}))},validate:function(){return this.user.exists||this.user.name?this.user.password||(this.passwordFocused=!0,0!=this.user.exists)?this.user.password&&this.user.password.length<6?(this.passwordFocused=!0,"Please ensure that your password is at least 6 characters long, to protect your account."):null:"Please choose a password.":"Please fill in your name."}}},y=w,x=Object(p["a"])(y,v,b,!1,null,null,null),I=x.exports,C=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("h2",[e._v(e._s(e.welcomeMessage))]),s("p",[e._v("You have successfully redeemed your code for "+e._s(e.redeemInfo.description)+". ")]),s("p",[e._v("Momentum Plus will now be available on your account.")]),e._m(0),e._m(1)])},$=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("p",[e._v("If you don't have Momentum, you can "),s("a",{attrs:{href:"/"}},[e._v("install it from our homepage")]),e._v(".")])},function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("p",[e._v("If you have any questions, please "),s("a",{attrs:{href:"/help"}},[e._v("contact our support team")]),e._v(".")])}],F={props:["user","redeemInfo"],computed:{welcomeMessage:function(){var e="Welcome to Momentum Plus";return this.user.name&&(e+=", "+this.user.name),e+="!",e}},mounted:function(){this.$emit("newHeight",this.$el.offsetHeight)}},P=F,E=Object(p["a"])(P,C,$,!1,null,null,null),H=E.exports,M={data:function(){return{}},props:["user","redeemInfo"],components:{"redeem-form-1":g,"redeem-form-2":I,"redeem-success":H},updated:function(){},methods:{setNewHeight:function(e){var t=function(e){var t=document.getElementsByClassName(e);return 1==t.length?t[0]:t};t("redeem-stage").style.height=e+120+"px";var s=t("gift-hero-headline").offsetHeight+e+120-t("redeem-hero").offsetHeight;s<0&&(s=0),this.$el.style.marginBottom=s+20+"px"}}},L=M,N=Object(p["a"])(L,i,u,!1,null,null,null),k=N.exports,S={data:function(){return{user:{email:null,name:null,autoLoggedIn:null,loggedIn:null,exists:null},redeemInfo:{coupon_code:null,description:null,redeemable:null,redeemSuccess:null,step:1}}},components:{"redeem-hero":k}},O=S,j=Object(p["a"])(O,n,a,!1,null,null,null),R=j.exports,T=s("70c8");r["default"].use(o["a"]);new r["default"]({el:"#app",mixins:[T["a"]],render:function(e){return e(R)}})}});
//# sourceMappingURL=redeem.b9c33be9.js.map